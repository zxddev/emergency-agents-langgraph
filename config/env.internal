# Dev environment for AI Emergency Brain
# Server endpoints - Using remote服务器已切换至 8.147.130.215
# 内网环境（备用）: QDRANT_URL=http://192.168.20.100:6333
QDRANT_URL=http://192.168.31.40:6333
QDRANT_API_KEY=qdrantzmkj123456
# 内网环境（备用）: NEO4J_URI=bolt://192.168.20.100:7687
NEO4J_URI=bolt://192.168.31.40:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=neo4jzmkj123456
# POSTGRES_DSN=postgresql://postgres:postgres123@192.168.31.40:19532/emergency_agent
# 使用外网跳板机 HAProxy 25432 → 内网 192.168.31.40:5432（优先）
# 切换为 8.147.130.215:19532（按运维要求）
POSTGRES_DSN=postgresql://postgres:postgres123@192.168.31.40:5432/emergency_agent
# 2025-11-03: 切换回192.168.31.40:5432（修复search_path参数不支持问题）
# POSTGRES_DSN=postgresql://postgres:postgres123@192.168.31.40:5432/emergency_agent
# 使用 SSH 本地隧道直连内网 PG（备用，本地调试专用）
# 原值: postgresql://postgres:postgres123@192.168.31.40:5432/emergency_agent
# POSTGRES_DSN=postgresql://postgres:postgres123@127.0.0.1:15432/emergency_agent
CHECKPOINT_SQLITE_PATH=./temp/checkpoints.sqlite3

# LLM API - 优先使用智谱 GLM 官方 OpenAI 兼容接口，内网 192.168.20.100 为备用
LLM_KEY_PRIMARY=a370127119ba4bd99eaa6136807cff88.jHf7Jy1L04C5f6Oe
LLM_KEY_SECONDARY=a370127119ba4bd99eaa6136807cff88.jHf7Jy1L04C5f6Oe
LLM_KEY_TERTIARY=a370127119ba4bd99eaa6136807cff88.jHf7Jy1L04C5f6Oe
LLM_KEY_LEGACY=a370127119ba4bd99eaa6136807cff88.jHf7Jy1L04C5f6Oe
LLM_KEY_RECON=a370127119ba4bd99eaa6136807cff88.jHf7Jy1L04C5f6Oe

OPENAI_BASE_URL=https://open.bigmodel.cn/api/paas/v4
OPENAI_API_KEY=${LLM_KEY_PRIMARY}
LLM_KEY_RESCUE=${LLM_KEY_SECONDARY}
LLM_KEY_INTENT=${LLM_KEY_TERTIARY}
LLM_KEY_STRATEGIC=${LLM_KEY_LEGACY}
# LLM模型配置 - 语音对话场景需要快速响应
# glm-4-flash: 10倍速度，适合实时对话（推荐）
# glm-4-air: 5倍速度，成本更低
# glm-4.6: 基准速度，不适合实时场景
LLM_MODEL=glm-4-flash
INTENT_LLM_MODEL=glm-4-flash
RECON_LLM_MODEL=glm-4.6
RECON_LLM_BASE_URL=https://open.bigmodel.cn/api/paas/v4
RECON_LLM_API_KEY=${LLM_KEY_RECON}
# 内网环境（备用）: LLM_ENDPOINTS=[{"name":"glm-official","base_url":"https://open.bigmodel.cn/api/paas/v4","api_key":"${LLM_KEY_LEGACY}","priority":120},{"name":"intranet-gateway","base_url":"http://192.168.20.100/v1","api_key":"${LLM_KEY_LEGACY}","priority":90}]
LLM_ENDPOINTS=[{"name":"glm-key-a","base_url":"https://open.bigmodel.cn/api/paas/v4","api_key":"${LLM_KEY_PRIMARY}","priority":150},{"name":"glm-key-b","base_url":"https://open.bigmodel.cn/api/paas/v4","api_key":"${LLM_KEY_SECONDARY}","priority":140},{"name":"glm-key-c","base_url":"https://open.bigmodel.cn/api/paas/v4","api_key":"${LLM_KEY_TERTIARY}","priority":130},{"name":"glm-key-legacy","base_url":"https://open.bigmodel.cn/api/paas/v4","api_key":"${LLM_KEY_LEGACY}","priority":120},{"name":"intranet-gateway","base_url":"http://192.168.31.40/v1","api_key":"${LLM_KEY_PRIMARY}","priority":90}]
LLM_ENDPOINT_GROUPS={"default":[{"name":"default-primary","base_url":"https://open.bigmodel.cn/api/paas/v4","api_key":"${LLM_KEY_PRIMARY}","priority":140}],"rescue":[{"name":"rescue-primary","base_url":"https://open.bigmodel.cn/api/paas/v4","api_key":"${LLM_KEY_RESCUE}","priority":150}],"intent":[{"name":"intent-primary","base_url":"https://open.bigmodel.cn/api/paas/v4","api_key":"${LLM_KEY_INTENT}","priority":150}],"strategic":[{"name":"strategic-primary","base_url":"https://open.bigmodel.cn/api/paas/v4","api_key":"${LLM_KEY_STRATEGIC}","priority":145}]}
LLM_FAILURE_THRESHOLD=1
LLM_RECOVERY_SECONDS=15
LLM_MAX_CONCURRENCY=5
LLM_REQUEST_TIMEOUT_SECONDS=300

# Embedding - Using cloud embedding service
EMBEDDING_MODEL=embedding-3
EMBEDDING_DIM=1536
RAG_OPENAI_API_KEY=${LLM_KEY_SECONDARY}
RAG_ANALYSIS_TIMEOUT=90

# --- ASR (语音识别) 配置 ---
# 说明：本项目使用自动故障转移机制，主Provider故障时自动切换到备用Provider
# 1) 主Provider（Primary）- 阿里云百炼（在线，推荐）
ASR_PRIMARY_PROVIDER=aliyun
DASHSCOPE_API_KEY=sk-8d00f0cf1c2040a99f70620e9f491f60
# 阿里云百炼API Key（北京地域）

# 2) 备用Provider（Fallback）- 本地 FunASR（私有化部署）
ASR_FALLBACK_PROVIDER=local
# 内网环境（备用）: VOICE_ASR_WS_URL=wss://192.168.20.100:10096
# VOICE_ASR_WS_URL=wss://192.168.31.40:10096
# 本地FunASR WebSocket URL，例如: wss://127.0.0.1:10097

# 可选：热词和分块配置
FUNASR_HOTWORDS_JSON=
FUNASR_CHUNK_SIZE=

# 健康检查间隔（秒）
HEALTH_CHECK_INTERVAL=30

# 语音合成（TTS）配置
# 内网环境（备用）: VOICE_TTS_URL=http://192.168.20.100:18002/api/tts
# VOICE_TTS_URL=http://192.168.31.40:18002/api/tts
VOICE_TTS_VOICE=zh-CN-XiaoxiaoNeural
SILERO_VAD_LOCAL_REPO=/home/msq/.cache/torch/hub/snakers4_silero-vad_master

# 高德地图 API 配置
AMAP_API_KEY=ce02c0925994ff5f7029db013b7e710e
AMAP_API_BACKUP_KEY=emengency-back
AMAP_API_URL=https://restapi.amap.com
AMAP_API_CONNECT_TIMEOUT=10
AMAP_API_READ_TIMEOUT=10
VIDEO_STREAM_MAP={"drone-1":"rtsp://streams.company.local/drone-1"}
VIDEO_VLLM_URL=https://open.bigmodel.cn/api/paas/v4
VIDEO_VLLM_API_KEY=a370127119ba4bd99eaa6136807cff88.jHf7Jy1L04C5f6Oe
VIDEO_VLLM_MODEL=glm-4.5v
KG_API_URL=http://192.168.31.40:8008
RAG_API_URL=http://192.168.31.40:8008

# Adapter Hub 配置
ADAPTER_HUB_BASE_URL=http://192.168.31.40:18090
ADAPTER_HUB_TIMEOUT=60
DEFAULT_ROBOTDOG_ID=11

# Java Orchestrator 网关地址
WEB_API_BASE_URL=http://127.0.0.1:28080/web-api

# --- 统一意图处理配置 ---
# 启用统一意图处理模式（合并分类器+验证器为单次LLM调用）
# 设置为 false 可零停机回退到旧版两阶段流水线
INTENT_UNIFIED_MODE=true

# 未知意图置信度阈值（0.0-1.0）
# 低于此阈值触发专业应急专家咨询系统
UNKNOWN_CONFIDENCE_THRESHOLD=0.7

# 统一意图解析失败时是否自动降级到旧版流水线
# true: 自动降级（推荐）, false: 抛出异常
INTENT_UNIFIED_FALLBACK=true

# 是否启用Mem0记忆管理（依赖Neo4j）
# 当前Neo4j环境不支持vector.similarity.cosine，暂时关闭Mem0以避免报错
ENABLE_MEM0=false
ENABLE_RAG=false
ENABLE_KG=false

# 风险区域缓存配置
RISK_CACHE_TTL_SECONDS=120
RISK_REFRESH_INTERVAL_SECONDS=60

# Redis 缓存配置
REDIS_URL=redis://192.168.31.40:6379/0
REDIS_PASSWORD=
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5
# 侦察方案缓存TTL（秒，默认1小时）
RECON_PLAN_CACHE_TTL=3600
