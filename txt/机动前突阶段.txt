# **“机动前突阶段”需求规格说明书 V1.0**

> 适用范围：AI应急大脑与全空间智能车辆系统
> 阶段边界：**从指挥员签发“出发命令”起**，至**抵达前突起始区（或进入灾情快速侦查阶段的第一个作业点）**为止；期间保持“边机动、边评估、边重规划”的动态闭环。
> 能力底座：动态路径规划智能体、实时风险评估智能体、通信协调智能体、态势自动标绘智能体、ASR/TTS 等（详见“模型矩阵/智能体/功能点”）。

---

## 1. 目标与关键结果（OKR）

* **O1：安全到达**：在复杂灾后交通与气象/地质风险下，将车队安全、准时地送抵前突起始区。
  **KR1**：首批 3 条候选线路 5 秒内生成；触发重规划到新候选集 ≤7 秒。
  **KR2**：沿途高危点（滑坡/泥石流/桥梁受损/积水深坑）检出率 ≥95%，漏报率 ≤5%。
* **O2：动态感知**：融合第三方交通/气象/地灾接口与自有传感器（视频、GNSS/IMU、雨量、路况观测）。
  **KR3**：告警端到端时延（数据到提醒）≤3 秒；高危阈值触发强提醒**必需被具备权限的席位确认**。
* **O3：协同分工**：四席位各尽其职，信息在“一张图”上同屏联动且可追溯。
  **KR4**：所有关键决策（绕行/不绕行、安全点侦察）100%留痕并可回放。

---

## 2. 席位职责与权限

### 2.1 指挥席

* 与上级指挥大厅持续联络，执行上级约束（封控/优先级/禁飞区）。
* 审阅 AI 推荐的**3 条线路**与评分（综合最优/最快/最安全），**拍板**选择/切换。
* 对车队实施任务指挥：绕行/不绕行、安全点侦察、无人机启用窗口、风险签署。
* 审批来自协调席/侦察席的**人工标注**与**线路变更提案**。

### 2.2 驾驶席

* 专注驾驶；接收**道路风险提醒**（TTS+HUD+振动）、限速/限高/限宽提示。
* 以**语音**询问“前方线路情况/剩余风险/下一个安全点”等，免手操作。
* 发生风险时执行**最短制动+避险指令**，保留驾驶优先权（AI 仅提示不强控）。

### 2.3 侦察席

* **行进安全辅助**：操控“神眼”高清远摄云台（远距观测）与“强声”喊话器（应急疏导）。
* **态势标绘**：自动/手动在地图标注关键对象（学校、医院、加油站、化工厂等），形成侦察任务区。
* 根据上级/指挥席指令规划无人机/机器人犬的**临时侦察**，回传视频与检测结果上图。

### 2.4 协调席

* 对接当地救援力量（医院、消防、武警、社会救援队），**邀请下载移动端 APP**登记队伍/装备/人员/位置（无 APP 时可手录）。
* 汇总外部口头/零散信息并**手动标绘**（如“某路段车祸、交通封控、桥梁损毁”），形成**变更建议**上送指挥席。
* 维护“社会力量图层”，用于路线安全与资源协同的**参考与备援**。

> 四席位权限分级、操作审计、TTS/ASR 支撑与多网通信保障，均沿用平台安全与通信基线。

---

## 3. 总体流程（泳道/时序）

1. **初始三线路生成（AI）** → 输出三条候选：综合最优/最快/最安全（避开所有已知风险）。
2. **指挥席选择** → 广播“选中路线 vX”。
3. **动态监测**（交通/气象/地灾 + 车载感知）→ 风险评估→与 DEM/地质库叠加→阈值判定。
4. **触发点 A：第三方事件（如车祸/封控）** → 强提醒 → 指挥席决定“绕行/不绕行”。

   * **不绕行**：AI 推荐**安全点**（靠近风险点且安全可视、可起降）→ 侦察席发起**无人机侦察闭环**→ 结果回传→是否改判。
   * **绕行**：快速重规划**三新路线**→ 指挥席再选。
5. **触发点 B：协调席人工标绘** → 相同重规划逻辑，但来源标注需指挥席签收后生效。
6. **持续循环，直至到达前突起始区**。

---

## 4. 功能需求（FR）

### FR-01 初始候选线路生成（3 条）

* **输入**：出发点、目标前突区（或多个候选前突区）、车辆参数（尺寸、载重、越野能力）、道路/桥涵/管制数据、禁限区、社会力量位置。
* **算法**：多目标 A* / D* Lite + 分段代价（通行性、时效、风险、能耗、通信覆盖），产生三条路线档案：

  * **综合最优**：多目标加权最优；
  * **最快**：时间优先；
  * **最安全**：最大化风险间距与避险缓冲。
* **时限**：≤5s；若数据缺失→回退至“离线底图+已有管制”。
* **可解释性**：每条路线显示“代价贡献条”（时间/风险/能耗/通信覆盖）。
* **支撑**：动态路径规划智能体。

### FR-02 动态风险融合与阈值告警

* **来源**：交通（事故/拥堵/封路）、气象（短临暴雨/雷暴/大风）、地灾（滑坡/泥石流预警）、车载“神眼”识别与路面观测、社会上报。
* **地学判据**：以 **DEM 坡度、地质敏感分区、河网与切坡路段**进行空间叠加，计算**危险分段**与**风险分数**。
* **阈值**：可配置多级（红/橙/黄/蓝）；达到橙及以上触发**强提醒**（TTS+高闪+方向指示），并要求席位确认。
* **时限**：数据入库到提醒 ≤3s。
* **支撑**：实时风险评估智能体、预警监测智能体。

### FR-03 指挥席决策与广播

* **操作**：查看三路线评分与风险段落 → 一键选路/换路；签署“带风险前进”需填写补救方案（如“安全点侦察+车距拉大”）。
* **广播**：将“选中路线 vX”与约束同步至驾驶/侦察/协调席及上级大厅；版本化留痕。
* **联动**：换路即触发驾驶席 HUD 与语音导航更新；侦察席自动刷新待侦察点。

### FR-04 驾驶席行车安全与语音交互

* **显示**：HUD/中控地图显示**前方 N 公里风险段**、限高/限宽、坡度、桥涵承载与道路等级。
* **语音指令**（ASR）：

  * “**查询前方线路**” → 播报最近 5 公里风险摘要；
  * “**下一个安全点**” → 给出距离、可见性、建议侦察载荷；
  * “**临时绕行**” → 触发三线路重规划。
* **TTS**：强提醒不可静音 10 秒；其后可降级。
* **支撑**：ASR/TTS、沿途风险预警、油耗/续航优化。

### FR-05 侦察席：神眼/强声与标注

* **神眼**：远摄云台 3D 定位上屏；支持**目标锁定/数字稳像/热像切换**；视频片段一键做证。
* **强声**：短语模板 + 临时文本播报（本地 TTS），分贝与方向可控，带**占线保护**。
* **标注**：

  * **自动标注**：基于数据库 POI（医院/学校/加油站/化工厂等）与视觉识别结果，AI 批量上图并分类；
  * **手动标注**：点/线/面+标签+置信度+图片/语音；
  * **侦察任务区**：框选区域 → 生成人/机侦察任务卡（航线/载荷/高度/返航点）。
* **无人机闭环**：从“安全点”快速起飞→回传视频→AI 识别道路阻断/滑坡迹象→形成**是否可通行**判据，回注到路线版本。
* **支撑**：空中侦察智能体、多模态视觉识别、态势自动标绘智能体。

### FR-06 协调席：社会力量对接与标绘

* **APP 引导**：生成队伍邀请码/二维码，APP 侧提交**人员/装备/位置/能力窗口**（带定位）；无 APP 时**手工录入**。
* **标绘事件**：对“车祸/封控/灾民聚集/救护接驳点”等进行**手动标绘**并附证据（照片/语音），提交**变更建议单**。
* **生效机制**：标绘一经**指挥席签收**，即触发 FR-07 重规划逻辑。
* **支撑**：接口开放与生态接入、数据融合与误差消解。

### FR-07 重规划触发与三路线再生

* **触发**：第三方事件、侦察结果“不可通行/风险过高”、协调席标绘被签收、气象阈值越界。
* **产出**：新一轮**3 条路线**（综合最优/最快/最安全），并给出**变化解释**（比如“XX 路段滑坡概率↑，已避让”）。
* **时限**：≤7s；若卫星/专网低带宽，先下发“粗略主干道+避险段”，细节渐进更新。
* **支撑**：动态路径规划智能体、通信协调智能体。

### FR-08 安全点推荐与侦察策略

* **选择逻辑**：与风险段保持**安全距离**（可配）、具备**良好视距/可落点/通信覆盖**，靠近备用撤离线。
* **输出**：安全点坐标、推荐起降方向、无人机任务模板（侦察高度/传感器/回传码率）。
* **异常**：若无合格安全点，提示“步进式前探”（车距拉大+低速推进），并强制上报。

### FR-09 一张图联动与版本化

* **图层**：路线（主/备）、风险热区、第三方告警、人工标绘、社会力量、无人机轨迹与成果、强声播报区。
* **版本**：路线与标注均版本化（v1,v2,...），所有席位可查看差异与时间线；撤回/回滚受权控制。
* **支撑**：态势实时标绘、灾情自动报送、审计追溯。

---

## 5. 数据模型（核心草案）

> 全量实体使用 ULID，含 `version/created_by/updated_by/audit_trail[]`。

**RouteCandidate**

```json
{
  "id": "RC-20251020-001",
  "type": "BEST_OVERALL|FASTEST|SAFEST",
  "geometry": {"type": "LineString", "coordinates": [...]},
  "cost": {"time_min": 86, "risk": 0.18, "energy_wh": 4200, "comm_coverage": 0.92},
  "risk_segments": [{"start_km": 12.4, "end_km": 13.1, "risk_level": "ORANGE", "reason": ["slope>20°","rain>20mm/h"]}],
  "constraints": ["height_limit_3.8m","bridge_load_20t"],
  "explain": ["绕开XX河右岸滑坡高敏地带","通过XX镇社会力量驻点可增援"]
}
```

**ThirdPartyAlert**

```json
{"id":"TPA-...","source":"TRAFFIC|MET|GEO","location":[...],"radius_m":300,
 "level":"ORANGE","message":"K123处车祸封闭","ttl_min":60}
```

**SafePoint**

```json
{"id":"SP-...","point":[...],"los_score":0.87,"landing_ok":true,"comm":"SAT|RELAY","distance_to_risk_m":1200}
```

**DroneReconMission**

```json
{"id":"DR-...","safe_point":"SP-...","waypoints":[...],
 "payloads":["EO","IR"],"alt_m":120,"return_to":"SP-...","objective":"RISK_VALIDATION"}
```

**Annotation（标注）**

```json
{"id":"AN-...","author_role":"COORD|RECON","geom":{"type":"Polygon","coordinates":[...]},
 "label":"TRAFFIC_ACCIDENT","confidence":0.8,"evidence":["pic://...","voice://..."],"status":"PENDING|SIGNED|REJECTED"}
```

**UnitProfile（社会力量）**

```json
{"id":"UNIT-...","name":"XX医院","type":"HOSPITAL","people":25,"equip":["AMBULANCE*3"],
 "app":"ONBOARD|OFFLINE","location":[...],"contact":"+86..."}
```

**DecisionLog**

```json
{"id":"DL-...","decision":"REROUTE|HOLD_AND_RECON","by":"COMMANDER",
 "reason":["TPA-...","DR-...=UNPASSABLE"],"timestamp":"2025-10-20T12:21:03Z"}
```

---

## 6. 核心算法与规则

### 6.1 路线评分函数（多目标）

* **目标**：最小化 `J = w1*Time + w2*Risk + w3*Energy - w4*CommCoverage - w5*SupportProximity`

  * `Risk`：分段风险积分（DEM 坡度、地质敏感分区、降雨强度、已知次生灾害概率、桥涵健康度）。
  * `CommCoverage`：主备链路（卫星/专网/中继）覆盖度。
  * `SupportProximity`：靠近社会力量/补给点的便利性。
* **三方案导出**：

  * **FASTEST**：`w1↑`; **SAFEST**：`w2↑`且强制避开高危多段；**BEST_OVERALL**：加权均衡。
* **滚动优化**：每 60 秒或触发事件后重算“前方 20–30km”窗口。

### 6.2 阈值规则（示例，可配置）

* **红色**：24h 降雨 > 100mm 且坡度 > 25° 且有历史滑坡点 2km 内 → **强制建议绕行**；
* **橙色**：雷达回波>强，河道水位快速上涨且临河路基 → **强提醒 + 安全点建议**；
* **黄色**：中度拥堵或轻微坍塌迹象 → **提醒 + 减速**。

> 阈值与推断由灾害预测评估模型与实时风险评估智能体给出，支持本地化校准。

### 6.3 安全点选址启发式

* 距风险段 ≥ 指定缓冲（默认 800–1500m）；
* DEM 平整度阈值、可回转与停车空间、卫星/中继覆盖度；
* 视距优选（LoS 至风险段中点）、就近备选撤离路线。

---

## 7. 接口设计（API/消息）

### 7.1 路线与重规划

* `POST /route/candidates`：入参{origin,target,vehicle,policy} → 返回三条候选。
* `POST /route/choose`：选择某候选并广播，生成 `RoutePlan vX`。
* `POST /route/replan`：触发重规划（原因：TPA/COORD/RECON/MET/GEO）。

### 7.2 风险与告警

* `POST /alerts/ingest`：交通/气象/地灾/社会力量事件入库（签名+TTL）。
* `WS /topics/alerts`：推送阈值越界 → 席位端强提醒。
* `GET /risk/segment?route_id=...`：返回前方 N 公里风险段与解释。

### 7.3 标注与任务

* `POST /annotations`：侦察/协调席提交标注（含证据）。
* `POST /annotations/{id}/sign`：指挥席签收/驳回。
* `POST /uav/missions`：从安全点模板快速生成侦察任务，返回航线与限制。

### 7.4 社会力量（APP）

* `POST /units/register`、`POST /units/update`、`GET /units/nearby`。
* `WS /topics/units`：位置与能力窗口增量更新。

### 7.5 语音与强声

* `POST /voice/commands`：驾驶席语音问答（ASR→NLP→TTS）。
* `POST /loudspeaker/cast`：侦察席强声播报，含方向/音量与占线保护。

> 接口安全、审计、带宽编排与多网容灾同平台基线保持一致。

---

## 8. UI/UE 要点（席位化）

* **指挥席**：三路线卡片+评分条；“变化解释”浮层；“绕行/不绕行/安全点侦察”三键。
* **驾驶席**：HUD 简明指引 + 前方风险条/方向箭头 + TTS；语音唤醒与简短问答。
* **侦察席**：双窗（神眼/地图）；一键“锁定→标注→派发 UAV”链路；强声快捷短语。
* **协调席**：社会力量列表（在线/离线）、APP 邀请码发放、标绘提案表单与证据上传。
* **公共**：一张图图层开关；时间轴回放；版本差异对比；强提醒弹层 10 秒内不可关闭。

---

## 9. 非功能性需求

* **性能**：三候选生成 ≤5s；重规划 ≤7s；强提醒时延 ≤3s；地图>60 FPS（桌面），≥30 FPS（车载）。
* **可用性**：核心服务≥99.9%；断网离线可运行（本地缓存与事务重放）。
* **通信**：卫星/5G/专网/中继自适应，带宽按优先级分级（指令>告警>视频>日志）。
* **安全**：分级分域、端到端加密、敏感操作二次认证、全链路审计可追溯。
* **OTA**：分批灰度、可回滚，不影响在途任务。

---

## 10. 验收与测试（节选用例）

1. **三路线生成**：给定地形复杂样例，输出三路线与差异解释；人工对拍通过性 ≥95%。
2. **第三方事件触发**：模拟“前方 5km 车祸”→ 强提醒 → 指挥席选择“绕行”→ 7 秒内产出三新路线。
3. **不绕行场景**：触发“橙色风险”→ 推荐安全点 → UAV 起飞 → 侦察回传判定“可通行”→ 继续前进。
4. **协调席标绘**：人工标绘“桥梁受损”+证据 → 指挥席签收 → 重规划生效；日志完整可回放。
5. **语音交互**：驾驶席口令“查询前方线路”→ 2 秒内播报要点；噪声 75 dB 条件下识别成功率 ≥90%。
6. **通信切换**：专网掉线→ 自动卫星/中继顶上；视频降码不丢音、指令不断链。
7. **强声/神眼联动**：强声播报期间，神眼画面叠加播报区并留档 30s 回放。
8. **审计**：抽查任一换路决策，能还原“触发→评估→决策→广播→执行”的完整链。

---

## 11. 异常与兜底

* **数据缺失**：第三方接口失联→ 使用离线底图与历史危险源；风险等级降级显示“置信度低”。
* **冲突信息**：不同来源对同一路段意见相反→ 标记“争议段”，要求侦察席前出验证。
* **无法选出安全点**：建议“步进式前探”，并强制上报上级指挥大厅。
* **重规划失败**：保留最近可用版本，并开启“人工引导模式”（大地标+方位+里程）。

---

## 12. 里程碑（建议）

* **M1（2 周）**：三路线生成/切换、强提醒、指挥席拍板与广播。
* **M2（4 周）**：DEM/气象/地灾融合阈值、协调席标绘触发重规划、神眼/强声上屏。
* **M3（6 周）**：安全点推荐与 UAV 闭环、APP 接入社会力量、离线容灾。
* **M4（8 周）**：性能/可靠性压测、全席位联动作战演练与复盘。

---

### 附：字段与枚举（摘录）

* **RiskLevel**：`RED|ORANGE|YELLOW|BLUE`
* **Decision**：`REROUTE|HOLD_AND_RECON|PROCEED_WITH_CAUTION`
* **Source**：`TRAFFIC|MET|GEO|RECON|COORD|UNIT_APP`
* **SeatRole**：`COMMAND|DRIVER|RECON|COORD`

---

**落地建议**：优先将 DEM/地质/雨强三要素跑通并与路线代价函数深度耦合，同时把“安全点→UAV 闭环验证”打磨为一键链路；第二阶段再引入社会力量 APP 的能力窗口联动，让“最安全路线”兼顾“到达即能打”。上述各项与平台“模型矩阵/智能体/功能点”一一对齐，可直接进入开发 Backlog。

---

如需，我可以再输出**席位界面原型草图**与**三路线评分条的可视化规范**，把这些需求进一步压成可执行的 UI/接口清单。
