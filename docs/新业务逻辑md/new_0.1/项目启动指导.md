# é¡¹ç›®å¯åŠ¨æŒ‡å¯¼ï¼ˆå¿«é€Ÿä¸Šæ‰‹ç‰ˆï¼‰

**æœ€åæ›´æ–°**ï¼š2025-11-02
**é€‚ç”¨ç‰ˆæœ¬**ï¼šemergency-agents-langgraph v0.1+

---

## âš ï¸ å¼€å§‹ä¹‹å‰å¿…è¯»

### æ ¸å¿ƒåŸåˆ™ï¼šå¿…é¡»ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ

æœ¬é¡¹ç›®**100%ä¾èµ–è™šæ‹Ÿç¯å¢ƒ**è¿è¡Œï¼Œç›´æ¥ä½¿ç”¨ç³»ç»ŸPythonä¼šå¯¼è‡´Bus errorï¼

**åŸå› **ï¼š
- é¡¹ç›®ä¾èµ–CPU-onlyç‰ˆæœ¬çš„PyTorchï¼ˆç”¨äºè¯­éŸ³VADæ£€æµ‹ï¼‰
- ç³»ç»ŸPythonå¯èƒ½å®‰è£…äº†CUDAç‰ˆPyTorch
- CUDAç‰ˆåœ¨WSL2ç¯å¢ƒä¸­ä¼šBus errorå´©æºƒ

**è§„åˆ™**ï¼š
- âœ… æ‰€æœ‰å‘½ä»¤å¿…é¡»åœ¨æ¿€æ´»venvåæ‰§è¡Œ
- âœ… æˆ–ä½¿ç”¨`.venv/bin/python`ç»å¯¹è·¯å¾„
- âŒ ç»ä¸ç›´æ¥è¿è¡Œç³»ç»Ÿ`python`æˆ–`pytest`

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆ5æ­¥å®Œæˆï¼‰

### Step 1ï¼šå…‹éš†é¡¹ç›®å¹¶è¿›å…¥ç›®å½•
```bash
cd /home/msq/gitCode/new_1/emergency-agents-langgraph
```

### Step 2ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆé¦–æ¬¡ï¼‰
```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬ï¼ˆéœ€è¦>=3.10ï¼‰
python3 --version

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv .venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆæ¯æ¬¡å¿…é¡»ï¼‰
source .venv/bin/activate
```

**ç¡®è®¤æ¿€æ´»æˆåŠŸ**ï¼š
```bash
# å‘½ä»¤æç¤ºç¬¦åº”è¯¥æ˜¾ç¤º (.venv)
# æ£€æŸ¥Pythonè·¯å¾„
which python
# åº”è¯¥è¾“å‡ºï¼š/home/msq/gitCode/new_1/emergency-agents-langgraph/.venv/bin/python
```

### Step 3ï¼šå®‰è£…ä¾èµ–
```bash
# ç¡®ä¿å·²æ¿€æ´»venvï¼
pip install -r requirements.txt

# é‡è¦ï¼šPyTorchå¿…é¡»ä½¿ç”¨CPU-onlyç‰ˆæœ¬
pip install torch torchaudio --index-url https://download.pytorch.org/whl/cpu
```

**éªŒè¯PyTorchå®‰è£…**ï¼š
```bash
python -c "import torch; print(f'âœ… torch {torch.__version__} å®‰è£…æˆåŠŸ')"
# åº”è¯¥è¾“å‡ºï¼šâœ… torch 2.4.1+cpu å®‰è£…æˆåŠŸï¼ˆæˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
```

### Step 4ï¼šé…ç½®ç¯å¢ƒå˜é‡
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat config/dev.env

# é…ç½®LLM API Keyï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
# ç¼–è¾‘ config/llm_keys.env
nano config/llm_keys.env
```

**å¿…é¡»é…ç½®çš„ç¯å¢ƒå˜é‡**ï¼š
- `OPENAI_API_KEY` æˆ–å¯¹åº”çš„LLM_KEY_*
- `POSTGRES_DSN`ï¼ˆå¦‚æœéœ€è¦è¿è¡Œé›†æˆæµ‹è¯•ï¼‰
- `NEO4J_URI`, `QDRANT_URL`ï¼ˆå¦‚æœéœ€è¦RAGåŠŸèƒ½ï¼‰

### Step 5ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
# æ–¹å¼1ï¼šä½¿ç”¨é¡¹ç›®è„šæœ¬ï¼ˆæ¨èï¼Œè‡ªåŠ¨æ¿€æ´»venvï¼‰
./scripts/dev-run.sh

# æ–¹å¼2ï¼šæ‰‹åŠ¨å¯åŠ¨ï¼ˆç¡®ä¿å·²æ¿€æ´»venvï¼‰
source .venv/bin/activate
export PYTHONPATH=src
python -m uvicorn emergency_agents.api.main:app --reload --port 8008
```

**éªŒè¯æœåŠ¡å¯åŠ¨æˆåŠŸ**ï¼š
```bash
# æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£
curl http://localhost:8008/healthz
# åº”è¯¥è¿”å›ï¼š{"status":"ok"}
```

---

## ğŸ§ª è¿è¡Œæµ‹è¯•

### å•å…ƒæµ‹è¯•ï¼ˆå¿«é€Ÿï¼Œæ— å¤–éƒ¨ä¾èµ–ï¼‰
```bash
# æ¿€æ´»venv
source .venv/bin/activate

# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
pytest -m unit -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_health.py -v
```

### é›†æˆæµ‹è¯•ï¼ˆéœ€è¦æ•°æ®åº“æœåŠ¡ï¼‰
```bash
# ç¡®ä¿æ•°æ®åº“æœåŠ¡å·²å¯åŠ¨
docker-compose -f docker-compose.dev.yml up -d

# åŠ è½½ç¯å¢ƒå˜é‡å¹¶è¿è¡Œé›†æˆæµ‹è¯•
set -a
source config/llm_keys.env
source config/dev.env
set +a

pytest -m integration -v
```

### éªŒè¯æ ¸å¿ƒåŠŸèƒ½
```bash
# æµ‹è¯•æ„å›¾è¯†åˆ«æµç¨‹
pytest tests/test_intent_flow_integration.py -v

# æµ‹è¯•Scoutæ–°èŠ‚ç‚¹
pytest tests/graph/test_scout_tactical_integration.py -v

# æµ‹è¯•Rescue Stateå¼ºç±»å‹
pytest tests/graph/test_rescue_state_typing.py -v
```

---

## ğŸ“‹ æ¯æ—¥å¼€å‘å·¥ä½œæµ

### æ—©ä¸Šå¼€å§‹å·¥ä½œ
```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/msq/gitCode/new_1/emergency-agents-langgraph

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆé‡è¦ï¼ï¼‰
source .venv/bin/activate

# 4. æ›´æ–°ä¾èµ–ï¼ˆå¦‚æœrequirements.txtæœ‰å˜åŒ–ï¼‰
pip install -r requirements.txt

# 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
./scripts/dev-run.sh
```

### å¼€å‘è¿‡ç¨‹ä¸­
```bash
# è¿è¡Œæµ‹è¯•ï¼ˆç¡®ä¿åœ¨venvä¸­ï¼‰
pytest tests/ -v

# æŸ¥çœ‹æ—¥å¿—
tail -f temp/server.log

# é‡å¯æœåŠ¡
kill $(cat temp/uvicorn.pid) && ./scripts/dev-run.sh
```

### æäº¤ä»£ç å‰
```bash
# 1. è¿è¡Œå®Œæ•´æµ‹è¯•
pytest tests/ -v

# 2. æ£€æŸ¥ä»£ç æ ¼å¼ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
# black src/ tests/
# ruff check src/ tests/

# 3. æäº¤ä»£ç 
git add .
git commit -m "feat: ä½ çš„æäº¤ä¿¡æ¯"
git push origin master
```

---

## âš¡ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### è™šæ‹Ÿç¯å¢ƒç®¡ç†
```bash
# æ¿€æ´»venv
source .venv/bin/activate

# é€€å‡ºvenv
deactivate

# æ£€æŸ¥æ˜¯å¦åœ¨venvä¸­
echo $VIRTUAL_ENV
# åº”è¯¥è¾“å‡ºï¼š/home/msq/gitCode/new_1/emergency-agents-langgraph/.venv

# ä¸æ¿€æ´»venvç›´æ¥è¿è¡Œï¼ˆä¸æ¨èï¼Œä½†å¯ç”¨ï¼‰
.venv/bin/python -c "import torch; print('OK')"
.venv/bin/pytest tests/ -v
```

### æœåŠ¡ç®¡ç†
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆåå°ï¼‰
./scripts/dev-run.sh

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
curl http://localhost:8008/healthz

# æŸ¥çœ‹æ—¥å¿—
tail -f temp/server.log

# åœæ­¢æœåŠ¡
kill $(cat temp/uvicorn.pid)

# æŸ¥çœ‹PrometheusæŒ‡æ ‡
curl http://localhost:8008/metrics
```

### æµ‹è¯•å‘½ä»¤
```bash
# å¿«é€Ÿå•å…ƒæµ‹è¯•
pytest -m unit -v

# é›†æˆæµ‹è¯•
pytest -m integration -v

# è¿è¡Œå•ä¸ªæµ‹è¯•
pytest tests/test_health.py::test_healthz_local -v

# æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
pytest tests/ -v -s

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
pytest --lf -v
```

### æ•°æ®åº“ç®¡ç†
```bash
# å¯åŠ¨æ•°æ®åº“æœåŠ¡
docker-compose -f docker-compose.dev.yml up -d

# åœæ­¢æ•°æ®åº“æœåŠ¡
docker-compose -f docker-compose.dev.yml down

# æŸ¥çœ‹æ•°æ®åº“è¿æ¥
./scripts/health-check.sh

# åˆå§‹åŒ–çŸ¥è¯†å›¾è°±
./scripts/init-db.sh
```

---

## ğŸ› å¸¸è§é—®é¢˜å¿«é€Ÿä¿®å¤

### é—®é¢˜1ï¼šBus errorï¼ˆæœ€å¸¸è§ï¼ï¼‰

**ç—‡çŠ¶**ï¼š
```bash
$ pytest tests/
Bus error (core dumped)
```

**åŸå› **ï¼šæœªæ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œä½¿ç”¨äº†ç³»ç»ŸPython

**ä¿®å¤**ï¼š
```bash
# æ–¹å¼1ï¼šæ¿€æ´»venv
source .venv/bin/activate
pytest tests/

# æ–¹å¼2ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„
.venv/bin/pytest tests/

# éªŒè¯ä¿®å¤
.venv/bin/python -c "import torch; print('âœ… OK')"
```

**è¯¦ç»†è¯Šæ–­**ï¼šå‚è§ `PyTorch-Bus-Erroré—®é¢˜è¯Šæ–­.md`

---

### é—®é¢˜2ï¼šModuleNotFoundError

**ç—‡çŠ¶**ï¼š
```bash
ModuleNotFoundError: No module named 'emergency_agents'
```

**åŸå› **ï¼šPYTHONPATHæœªè®¾ç½®

**ä¿®å¤**ï¼š
```bash
# è®¾ç½®PYTHONPATH
export PYTHONPATH=src

# æˆ–ä½¿ç”¨-mè¿è¡Œ
python -m emergency_agents.api.main

# æˆ–ä½¿ç”¨é¡¹ç›®è„šæœ¬ï¼ˆè‡ªåŠ¨è®¾ç½®ï¼‰
./scripts/dev-run.sh
```

---

### é—®é¢˜3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼š
```bash
psycopg.OperationalError: connection failed
```

**åŸå› **ï¼šæ•°æ®åº“æœåŠ¡æœªå¯åŠ¨æˆ–é…ç½®é”™è¯¯

**ä¿®å¤**ï¼š
```bash
# æ£€æŸ¥é…ç½®
grep POSTGRES_DSN config/dev.env

# æ£€æŸ¥æœåŠ¡
./scripts/health-check.sh

# å¯åŠ¨æœåŠ¡ï¼ˆå¦‚æœä½¿ç”¨Dockerï¼‰
docker-compose -f docker-compose.dev.yml up -d

# éªŒè¯è¿æ¥
psql "$POSTGRES_DSN" -c "SELECT 1"
```

---

### é—®é¢˜4ï¼šLLMè°ƒç”¨å¤±è´¥

**ç—‡çŠ¶**ï¼š
```bash
openai.APIError: Unauthorized
```

**åŸå› **ï¼šAPI Keyæœªé…ç½®æˆ–è¿‡æœŸ

**ä¿®å¤**ï¼š
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $OPENAI_API_KEY

# åŠ è½½é…ç½®æ–‡ä»¶
set -a
source config/llm_keys.env
source config/dev.env
set +a

# æµ‹è¯•LLMè¿æ¥
curl -X POST "$OPENAI_BASE_URL/chat/completions" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"model":"glm-4-flash","messages":[{"role":"user","content":"hi"}]}'
```

---

### é—®é¢˜5ï¼šç«¯å£å·²è¢«å ç”¨

**ç—‡çŠ¶**ï¼š
```bash
OSError: [Errno 98] Address already in use
```

**åŸå› **ï¼šç«¯å£8008å·²è¢«å…¶ä»–è¿›ç¨‹å ç”¨

**ä¿®å¤**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8008
# æˆ–
netstat -tlnp | grep 8008

# æ€æ­»è¿›ç¨‹
kill <PID>

# æˆ–ä½¿ç”¨é¡¹ç›®è„šæœ¬æ¸…ç†
kill $(cat temp/uvicorn.pid) 2>/dev/null || true

# ä½¿ç”¨å…¶ä»–ç«¯å£å¯åŠ¨
python -m uvicorn emergency_agents.api.main:app --port 8009
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```bash
# å®æ—¶æ—¥å¿—
tail -f temp/server.log

# è¿‡æ»¤é”™è¯¯
tail -f temp/server.log | grep -i error

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
tail -100 temp/server.log
```

### äº¤äº’å¼è°ƒè¯•
```bash
# ä½¿ç”¨IPython
pip install ipython
ipython

# åœ¨ä»£ç ä¸­æ·»åŠ æ–­ç‚¹
import pdb; pdb.set_trace()

# æˆ–ä½¿ç”¨ipdb
pip install ipdb
import ipdb; ipdb.set_trace()
```

### æ€§èƒ½åˆ†æ
```bash
# æŸ¥çœ‹PrometheusæŒ‡æ ‡
curl http://localhost:8008/metrics | grep -E "intent|llm|graph"

# ä½¿ç”¨cProfile
python -m cProfile -o profile.stats -m pytest tests/
python -c "import pstats; p = pstats.Stats('profile.stats'); p.sort_stats('cumtime').print_stats(20)"
```

---

## ğŸ“š è¿›é˜¶é˜…è¯»

- **å®Œæ•´æ–‡æ¡£**ï¼š`/docs/æ–°ä¸šåŠ¡é€»è¾‘md/new_0.1/`
- **LangGraphæœ€ä½³å®è·µ**ï¼š`/docs/æ–°ä¸šåŠ¡é€»è¾‘md/langgraphèµ„æ–™æœ€ä½³å®è·µ/`
- **APIæ–‡æ¡£**ï¼šå¯åŠ¨æœåŠ¡åè®¿é—® http://localhost:8008/docs
- **é—®é¢˜è¯Šæ–­**ï¼š`PyTorch-Bus-Erroré—®é¢˜è¯Šæ–­.md`
- **é¡¹ç›®æ¶æ„**ï¼š`CLAUDE.md`, `QUICK-START.md`

---

## ğŸ’¡ æœ€ä½³å®è·µ

### DOï¼ˆæ¨èåšæ³•ï¼‰
- âœ… æ¯æ¬¡å¼€å§‹å·¥ä½œå…ˆæ¿€æ´»venv
- âœ… ä½¿ç”¨é¡¹ç›®è„šæœ¬ï¼ˆ`./scripts/*.sh`ï¼‰
- âœ… æäº¤å‰è¿è¡Œå®Œæ•´æµ‹è¯•
- âœ… ä½¿ç”¨`pytest -m unit`å¿«é€ŸéªŒè¯
- âœ… æŸ¥çœ‹`temp/server.log`æ’æŸ¥é—®é¢˜
- âœ… éµå¾ªä¸­æ–‡æ³¨é‡Šã€è‹±æ–‡ä»£ç è§„èŒƒ

### DON'Tï¼ˆé¿å…åšæ³•ï¼‰
- âŒ ç›´æ¥è¿è¡Œç³»ç»ŸPythonæˆ–pytest
- âŒ è·³è¿‡è™šæ‹Ÿç¯å¢ƒ
- âŒ ç¡¬ç¼–ç é…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
- âŒ æäº¤æœªæµ‹è¯•çš„ä»£ç 
- âŒ ä½¿ç”¨`--break-system-packages`å®‰è£…åŒ…
- âŒ å¿½è§†Bus errorè­¦å‘Š

---

## ğŸ†˜ è·å–å¸®åŠ©

### è‡ªåŠ©è¯Šæ–­
1. æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒæ˜¯å¦æ¿€æ´»ï¼š`echo $VIRTUAL_ENV`
2. æ£€æŸ¥Pythonè·¯å¾„ï¼š`which python`
3. æ£€æŸ¥torchç‰ˆæœ¬ï¼š`python -c "import torch; print(torch.__version__)"`
4. è¿è¡Œå¥åº·æ£€æŸ¥ï¼š`./scripts/health-check.sh`
5. æŸ¥çœ‹æ—¥å¿—ï¼š`tail -f temp/server.log`

### æ–‡æ¡£èµ„æº
- **æœ¬æ–‡æ¡£**ï¼šå¿«é€Ÿå¯åŠ¨å’Œå¸¸è§é—®é¢˜
- **PyTorch-Bus-Erroré—®é¢˜è¯Šæ–­.md**ï¼šBus errorè¯¦ç»†åˆ†æ
- **QUICK-START.md**ï¼šé¡¹ç›®æ¦‚è§ˆå’ŒæŠ€æœ¯æ ˆ
- **CLAUDE.md**ï¼šå¼€å‘è§„èŒƒå’Œé…ç½®è¯´æ˜

### é—®é¢˜å‡çº§
- æœç´¢å·²çŸ¥é—®é¢˜ï¼š`grep -r "ä½ çš„é”™è¯¯ä¿¡æ¯" docs/`
- æŸ¥çœ‹gitå†å²ï¼š`git log --grep="ç›¸å…³å…³é”®è¯"`
- åˆ›å»ºGitHub Issueï¼ˆå¦‚æœæ˜¯æ–°é—®é¢˜ï¼‰

---

**è®°ä½æ ¸å¿ƒåŸåˆ™ï¼šå§‹ç»ˆä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼** ğŸ¯

```bash
# æ¯æ¬¡å¼€å§‹å·¥ä½œçš„ç¬¬ä¸€æ¡å‘½ä»¤
source .venv/bin/activate

# è¿™æ ·ä½ å°±ä¸ä¼šé‡åˆ°99%çš„é—®é¢˜ï¼
```
