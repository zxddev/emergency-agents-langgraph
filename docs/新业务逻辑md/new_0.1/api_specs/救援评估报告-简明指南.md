# 救援评估报告 API（简明指南）

- 路径：`POST /reports/rescue-assessment`
- 目的：根据录入字段生成专业的救援评估报告（纯文本/Markdown）。固定使用 `glm-4.6`。
- Header：`Content-Type: application/json`

## 入参（Body）
- `basic_info.disaster_type: string` 灾种（枚举，如：地震灾害/洪涝灾害/...）。
- `basic_info.occurrence_time: string` 灾害发生时间（ISO8601）。
- `basic_info.report_time: string` 生成时间（ISO8601）。
- `basic_info.location: string` 影响行政区描述。
- `basic_info.command_unit: string` 指挥单位名称。
- 其余可选字段：`frontline_overview`、`communication_status`、`weather_trend`。
- 统计类：`casualty_stats.*`、`disruption_status.*`、`infrastructure_damage.*`、`agriculture_damage.*`、`economy_impact.*`。
- 应急行动：`emergency_actions.actions[]`（名称/部门/人数/装备/开始结束时间）。
- 资源与装备：`resource_usage.*`（车辆/直升机/无人机/机器人/人员等投入消耗）。

> 字段详解请参考代码模型：`src/emergency_agents/api/reports.py:21` 起各个 Pydantic 模型定义。

## 返回（JSON）
- `report_text: string` Markdown 正文（7~9章，结构化，适合直接渲染/下载）。
- `meta: { duration_ms:number, model:string }` 生成耗时与模型信息。

## 错误
- 502: 模型生成失败（上游不可用或请求超时）。
- 400: 校验失败（必填字段缺失或类型错误）。

## 调用示例
```bash
curl -X POST http://<host:port>/reports/rescue-assessment \
  -H 'Content-Type: application/json' \
  -d '{
    "basic_info": {
      "disaster_type": "地质灾害",
      "occurrence_time": "2025-11-03T00:00:00Z",
      "report_time": "2025-11-03T01:00:00Z",
      "location": "四川省阿坝州茂县",
      "command_unit": "茂县应急管理局"
    },
    "casualty_stats": {"affected_population": 1200},
    "disruption_status": {"road_blocked_villages": 3},
    "infrastructure_damage": {"collapsed_buildings": 12},
    "resource_usage": {"uav_count": 3, "robot_dog_count": 1}
  }'
```

## 代码参考
- 路由实现：`src/emergency_agents/api/reports.py:1`
- 固定模型名：`src/emergency_agents/api/reports.py:387`、`src/emergency_agents/api/reports.py:1115` 使用 `model="glm-4.6"`

