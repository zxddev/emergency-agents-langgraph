# 事件类型与级别映射说明

本说明梳理 LangGraph → Java Web-API → 前端 三端关于事件分类/分级的约束关系，后续扩展需保持一致。

## 1. 后端事件类型（字符串）
- 定义位置：`emergency-agents-langgraph/sql/operational.sql` 中的 `operational.event_type_enum`；Java 对应 `com.cykj.webapi.enums.EventType`。
- 允许值（全部小写 snake_case）：
  - `infrastructure_failure`
  - `people_trapped`
  - `secondary_hazard`
  - `resource_request`
  - `external_info`
  - `transit_update`
  - `communication`
  - `sensor_data`
  - `uav_intelligence`
  - `road_condition`
  - `position_report`
- LangGraph 统一提示词会校验该字段：`src/emergency_agents/intent/providers/llm.py`、`src/emergency_agents/intent/unified_intent.py`。

## 2. 事件级别（四级制）
- Java 枚举：`com.cykj.webapi.enums.EventLevel`，对应字段 `events.event_level`。
- 四个枚举：
  | 代码 | 中文 | levelValue | 说明 |
  | ---- | ---- | ---------- | ---- |
  | `LEVEL_1` | 特别重大 | 1 | 国家级响应 |
  | `LEVEL_2` | 重大 | 2 | 省级响应 |
  | `LEVEL_3` | 较大 | 3 | 市级响应 |
  | `LEVEL_4` | 一般 | 4 | 县级响应 |
- 告警生成时若未指定等级，`EventScenarioService.mapEventLevel()` 依据灾害强度推算（≥7→1级、≥6→2级、≥4.5→3级、剩余 4 级）。

## 3. 前端灾害类型编码（数字）
- 前端要求 `eventType` 为 1~9 的整数，用于选择图标（`ai-broadcast.jsx:168-180`）。
- Java 通过 `EventServiceImpl.mapEventTypeToHazardType` / `HazardType` 枚举映射：
  | 编号 | 灾害类别 |
  | ---- | -------- |
  | 1 | 地震 (earthquake) |
  | 2 | 洪涝灾害 (flood) |
  | 3 | 山体滑坡/泥石流 (landslide) |
  | 4 | 台风 (typhoon) |
  | 5 | 森林火灾 (wildfire) |
  | 6 | 危化品泄露 (hazardous_leak) |
  | 7 | 油罐车爆炸 (tanker_explosion) |
  | 8 | 社会安全事件 (security_incident) |
  | 9 | 突发传染病疫情 (epidemic) |
  | 21 | other（未映射类型默认） |
- 前端图标位于 `public/image/event/{eventType}/{eventLevel}.svg`。

## 4. 端到端数据流
1. LangGraph 统一意图/校验要求 `event_type` 为上述 11 个枚举之一；缺失或无效会中断。
2. Java `EventServiceImpl` 调用 `mapEventTypeToHazardType` 将事件类型转为前端编码，同时根据事件数据确定 `eventLevel`。
3. WebSocket 推送 payload 中：
   - `eventType`：1~9 数值；
   - `eventLevel`：1~4；
   - `extra.eventType`：保留小写字符串（用于 H5/面板展示下游模块）。
4. 前端 `ai-broadcast.jsx` 校验 `eventType/eventLevel` 并加载对应 SVG 图标。

## 5. 扩展/变更指引
- **新增事件类型**：同时更新 `operational.event_type_enum`、`EventType` 枚举、`mapEventTypeToHazardType` 映射、前端图标与枚举常量。
- **新增灾害编码**：扩展 `HazardType` 枚举（value + code）及静态资源，更新 `PLAN`、`AI 推送` 等模块使用。
- **变更级别规则**：同步修改 `EventLevel` 枚举、`mapEventLevel` 逻辑及前端提示色 (`PROMPT_LEVEL_COLOR`)。

保持三端一致可避免“未知字段”“图标缺失”等运行时错误。MD
