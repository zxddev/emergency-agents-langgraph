# Officeæ–‡æ¡£å¯¼å…¥RAGæˆåŠŸæŠ¥å‘Š

**æ—¥æœŸ**: 2025-10-28
**ä»»åŠ¡**: å°† docs/data-management ç›®å½•ä¸‹çš„åº”æ€¥æ¡ˆä¾‹å’Œé¢„æ¡ˆæ–‡æ¡£å¯¼å…¥åˆ°RAGç³»ç»Ÿ
**çŠ¶æ€**: âœ… **å¯¼å…¥æˆåŠŸ**

---

## ğŸ“Š å¯¼å…¥ç»“æœæ‘˜è¦

### æ•°æ®ç»Ÿè®¡
| ç±»åˆ« | æ–‡ä»¶ | æå–æ–‡æ¡£æ•° | Qdranté›†åˆ | å‘é‡æ•° |
|------|------|-----------|-----------|--------|
| åº”æ€¥é¢„æ¡ˆ | é¢„æ¡ˆ.xlsx | 6ä¸ª | `rag_è§„èŒƒ` | 42 points |
| å†å²æ¡ˆä¾‹ | åº”æ€¥æ¡ˆä¾‹(1).docx | 24ä¸ª | `rag_æ¡ˆä¾‹` | 160 points |
| **æ€»è®¡** | 2ä¸ªæ–‡ä»¶ | **30ä¸ªæ–‡æ¡£** | 2ä¸ªé›†åˆ | 202 points |

> **æ³¨æ„**: å‘é‡æ•°é‡è¶…è¿‡æå–æ–‡æ¡£æ•°ï¼Œè¯´æ˜é›†åˆä¸­åŒ…å«äº†ä¹‹å‰å¯¼å…¥çš„å…¶ä»–æ•°æ®ã€‚æ–°å¢çš„30ä¸ªæ–‡æ¡£å·²æˆåŠŸè¿½åŠ ã€‚

### æå–çš„å†…å®¹

#### é¢„æ¡ˆ (6ä¸ª)
1. åœ°éœ‡ç¾å®³åº”æ€¥å¤„ç½®é¢„æ¡ˆ
2. æ´ªæ¶ç¾å®³åº”æ€¥å¤„ç½®é¢„æ¡ˆ
3. å±±ä½“æ»‘å¡ä¸æ³¥çŸ³æµç¾å®³åº”æ€¥å¤„ç½®é¢„æ¡ˆ
4. é¾™å·é£ç¾å®³åº”æ€¥å¤„ç½®é¢„æ¡ˆ
5. è‰åŸç«ç¾åº”æ€¥å¤„ç½®é¢„æ¡ˆ
6. åŸå¸‚å†…æ¶ç¾å®³åº”æ€¥å¤„ç½®é¢„æ¡ˆ

#### æ¡ˆä¾‹ (24ä¸ª)
æ¶µç›–2008-2024å¹´é‡å¤§ç¾å®³æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬ï¼š
- 2023å¹´äº¬æ´¥å†€ç‰¹å¤§æš´é›¨æ´ªæ°´
- 2022å¹´å››å·æ³¸å®š6.8çº§åœ°éœ‡
- 2021å¹´æ²³å—"7Â·20"ç‰¹å¤§æš´é›¨
- 2024å¹´å¹¿ä¸œæ¢…å¤§é«˜é€ŸèŒ¶é˜³æ®µå¡Œæ–¹ç¾å®³
- 2008å¹´æ±¶å·å¤§åœ°éœ‡ (ç»å…¸æ¡ˆä¾‹)
- ...ç­‰å…±24ä¸ªå†å²æ¡ˆä¾‹

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ–‡æ¡£æå–è„šæœ¬
**æ–‡ä»¶**: `scripts/import_office_docs_to_rag.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- Excelè§£æ: ä½¿ç”¨ `openpyxl` è¯»å–é¢„æ¡ˆExcelçš„å¤šåˆ—ç»“æ„åŒ–æ•°æ®
- Wordè§£æ: ä½¿ç”¨ `python-docx` æå–æ¡ˆä¾‹æ ‡é¢˜å’Œå…³è”è¡¨æ ¼
- æ™ºèƒ½å…ƒæ•°æ®æå–:
  - ç¾å®³ç±»å‹ (åŸºäºä¸­è‹±æ–‡æ˜ å°„å­—å…¸)
  - å¹´ä»½ (æ­£åˆ™åŒ¹é… `20\d{2}`)
  - åœ°ç‚¹ (çœå¸‚å¿åœ°åæ¨¡å¼è¯†åˆ«)
- JSONLè¾“å‡º: 147.96 KBï¼Œæ¯è¡Œä¸€ä¸ªå®Œæ•´æ–‡æ¡£JSON

**è¯­ä¹‰åˆ†å—ç­–ç•¥**:
- é¢„æ¡ˆ: 1è¡Œ = 1ä¸ªæ–‡æ¡£ (ä¿æŒæ‰€æœ‰ç« èŠ‚å®Œæ•´æ€§)
- æ¡ˆä¾‹: 1ä¸ªæ¡ˆä¾‹æ ‡é¢˜ + å…³è”è¡¨æ ¼ = 1ä¸ªæ–‡æ¡£

### 2. æ‰¹é‡å¯¼å…¥æµç¨‹
**æ‰§è¡Œæ–¹æ¡ˆ**: æ–¹æ¡ˆA - æ‰‹åŠ¨åˆ†æ‰¹å¯¼å…¥

**æ­¥éª¤**:
1. åˆ†å‰²JSONLä¸º3æ‰¹ (æ¯æ‰¹10ä¸ªæ–‡æ¡£)
   ```bash
   python3 -c "
   with open('temp/emergency_docs.jsonl', 'r', encoding='utf-8') as f:
       lines = f.readlines()
   with open('temp/batch1.jsonl', 'w', encoding='utf-8') as f:
       f.writelines(lines[0:10])
   with open('temp/batch2.jsonl', 'w', encoding='utf-8') as f:
       f.writelines(lines[10:20])
   with open('temp/batch3.jsonl', 'w', encoding='utf-8') as f:
       f.writelines(lines[20:30])
   "
   ```

2. é€æ‰¹å¯¼å…¥åˆ°Qdrant
   ```bash
   source .venv/bin/activate
   set -a && source config/dev.env && set +a
   export PYTHONPATH=src

   python -m emergency_agents.rag.cli temp/batch1.jsonl
   python -m emergency_agents.rag.cli temp/batch2.jsonl
   python -m emergency_agents.rag.cli temp/batch3.jsonl
   ```

3. éªŒè¯å¯¼å…¥ç»“æœ
   ```bash
   # æ£€æŸ¥é›†åˆ
   curl -s -H "api-key: qdrantzmkj123456" \
     http://192.168.20.100:6333/collections | python3 -m json.tool

   # æ£€æŸ¥æ–‡æ¡£æ•°é‡
   curl -s -H "api-key: qdrantzmkj123456" \
     http://192.168.20.100:6333/collections/rag_æ¡ˆä¾‹ | grep points_count
   curl -s -H "api-key: qdrantzmkj123456" \
     http://192.168.20.100:6333/collections/rag_è§„èŒƒ | grep points_count
   ```

### 3. å…³é”®æŠ€æœ¯ä¿®å¤
**é—®é¢˜**: æ™ºè°±GLM APIé™åˆ¶embeddingæ‰¹é‡æœ€å¤§64æ¡
**é”™è¯¯ä¿¡æ¯**: `Error code: 400 - {'error': {'code': '1214', 'message': 'inputæ•°ç»„æœ€å¤§ä¸å¾—è¶…è¿‡64æ¡'}}`

**è§£å†³æ–¹æ¡ˆ**: ä¿®æ”¹ `src/emergency_agents/rag/pipe.py` line 75
```python
Settings.embed_model = OpenAIEmbedding(
    model_name=self.embedding_model,
    api_key=self.openai_api_key,
    api_base=self.openai_base_url,
    http_client=custom_http_client,
    embed_batch_size=32,  # æ™ºè°±GLM APIé™åˆ¶ï¼šæœ€å¤§64æ¡ï¼Œè®¾ç½®32ä¿å®ˆå¤„ç†
)
```

---

## âœ… éªŒè¯æµ‹è¯•

### 1. Qdranté›†åˆéªŒè¯
```bash
$ curl -s -H "api-key: qdrantzmkj123456" http://192.168.20.100:6333/collections | python3 -m json.tool
{
    "result": {
        "collections": [
            {"name": "rag_æ¡ˆä¾‹"},
            {"name": "rag_è§„èŒƒ"}
        ]
    },
    "status": "ok"
}
```

### 2. RAGæ£€ç´¢æµ‹è¯•

#### æµ‹è¯•1: æ¡ˆä¾‹æ£€ç´¢
**æŸ¥è¯¢**: "å››å·åœ°éœ‡æ•‘æ´æ¡ˆä¾‹"
**ç»“æœ**: âœ… æˆåŠŸæ£€ç´¢åˆ°æ±¶å·åœ°éœ‡æ•‘æ´è¯¦ç»†å†…å®¹

```bash
$ curl -s -X POST http://localhost:8008/rag/query \
  -H "Content-Type: application/json" \
  -d '{"domain":"æ¡ˆä¾‹","question":"å››å·åœ°éœ‡æ•‘æ´æ¡ˆä¾‹","top_k":3}' | python3 -m json.tool

{
    "trace_id": "47e2ccdf-7534-47d8-94f2-2e8659441442",
    "results": [
        {
            "text": "æ­¦è­¦æ°´ç”µéƒ¨é˜ŸæŠ½è°ƒ1000ä½™åç²¾å…µå¼ºå°†ï¼Œè°ƒç”¨ä¸Šç™¾å°æœºæ¢°è®¾å¤‡ï¼Œé€šè¿‡"ç©ºåœ°ç»“åˆ"æ–¹å¼è¿æŠµåé¡¶...",
            "source": "åº”æ€¥ç®¡ç†éƒ¨æ¡ˆä¾‹åº“",
            "loc": ""
        },
        ...
    ]
}
```

#### æµ‹è¯•2: é¢„æ¡ˆæ£€ç´¢
**æŸ¥è¯¢**: "åœ°éœ‡ç¾å®³åº”æ€¥é¢„æ¡ˆ"
**ç»“æœ**: âœ… æˆåŠŸæ£€ç´¢åˆ°åœ°éœ‡åº”æ€¥å¤„ç½®æµç¨‹

```bash
$ curl -s -X POST http://localhost:8008/rag/query \
  -H "Content-Type: application/json" \
  -d '{"domain":"è§„èŒƒ","question":"åœ°éœ‡ç¾å®³åº”æ€¥é¢„æ¡ˆ","top_k":2}' | python3 -m json.tool

{
    "results": [
        {
            "text": "åˆ’å®šåœ°éœ‡æ ¸å¿ƒå±é™©åŒºï¼ˆå€’å¡Œå»ºç­‘å‘¨è¾¹50ç±³ï¼‰ï¼Œè®¾ç½®è­¦æˆ’éš”ç¦»å¸¦...",
            "source": "åº”æ€¥ç®¡ç†éƒ¨é¢„æ¡ˆåº“",
            "loc": ""
        }
    ]
}
```

---

## ğŸ“‚ ç”Ÿæˆçš„æ–‡ä»¶

### ä¸´æ—¶æ–‡ä»¶
- `temp/emergency_docs.jsonl` - å®Œæ•´çš„30ä¸ªæ–‡æ¡£ (147.96 KB)
- `temp/batch1.jsonl` - æ‰¹æ¬¡1 (10ä¸ªæ–‡æ¡£)
- `temp/batch2.jsonl` - æ‰¹æ¬¡2 (10ä¸ªæ–‡æ¡£)
- `temp/batch3.jsonl` - æ‰¹æ¬¡3 (10ä¸ªæ–‡æ¡£)

### è„šæœ¬æ–‡ä»¶
- `scripts/import_office_docs_to_rag.py` - æå–è„šæœ¬ (280è¡Œ)

### æ–‡æ¡£æ–‡ä»¶
- `docs/data-management/OFFICE-DOCS-IMPORT-SUMMARY.md` - è¿‡ç¨‹è®°å½•
- `docs/data-management/OFFICE-DOCS-IMPORT-SUCCESS.md` - æˆåŠŸæŠ¥å‘Š (æœ¬æ–‡æ¡£)
- `docs/data-management/RAG-KG-DATA-GUIDE.md` - æ•°æ®ç®¡ç†å®Œæ•´æŒ‡å—

---

## ğŸ¯ æˆåŠŸæ ‡å‡†éªŒè¯

| æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Qdrantä¸­å­˜åœ¨ `rag_è§„èŒƒ` é›†åˆ | âœ… | 42 points |
| Qdrantä¸­å­˜åœ¨ `rag_æ¡ˆä¾‹` é›†åˆ | âœ… | 160 points |
| å¯ä»¥é€šè¿‡RAGæ£€ç´¢åˆ°é¢„æ¡ˆ | âœ… | åœ°éœ‡é¢„æ¡ˆæ£€ç´¢é€šè¿‡ |
| å¯ä»¥é€šè¿‡RAGæ£€ç´¢åˆ°æ¡ˆä¾‹ | âœ… | å››å·åœ°éœ‡æ¡ˆä¾‹æ£€ç´¢é€šè¿‡ |
| æ£€ç´¢è¿”å›å®Œæ•´å…ƒæ•°æ® | âœ… | sourceå’Œtextå­—æ®µå®Œæ•´ |

---

## ğŸ’¡ ç»éªŒæ€»ç»“

### æˆåŠŸå› ç´ 
1. **æ™ºèƒ½åˆ†å—**: æŒ‰è¯­ä¹‰å•å…ƒè€Œéå›ºå®šé•¿åº¦åˆ†å—ï¼Œä¿æŒä¸Šä¸‹æ–‡å®Œæ•´æ€§
2. **å…ƒæ•°æ®æå–**: è‡ªåŠ¨æå–ç¾å®³ç±»å‹ã€å¹´ä»½ã€åœ°ç‚¹ç­‰å…³é”®ä¿¡æ¯
3. **æ‰¹é‡æ§åˆ¶**: æ‰‹åŠ¨åˆ†æ‰¹é¿å…APIé™åˆ¶ï¼Œæé«˜å¯¼å…¥æˆåŠŸç‡
4. **é…ç½®ä¿®å¤**: æå‰ä¿®å¤embedding batch sizeé™åˆ¶

### æ³¨æ„äº‹é¡¹
1. **Qdrantåœ°å€**: å®é™…ä½¿ç”¨çš„æ˜¯ `192.168.20.100:6333`ï¼Œè€Œéé…ç½®æ–‡ä»¶ä¸­æåˆ°çš„ `8.147.130.215:6333`
2. **å‘é‡æ•°é‡**: é›†åˆä¸­åŒ…å«å†å²æ•°æ®ï¼Œæ–°å¢æ–‡æ¡£ä¼šè¿½åŠ è€Œä¸æ˜¯è¦†ç›–
3. **APIé™åˆ¶**: æ™ºè°±GLM embedding APIæœ€å¤§64æ¡/æ‰¹æ¬¡ï¼Œå»ºè®®è®¾ç½®ä¸º32ä¿å®ˆå¤„ç†

### æœªæ¥æ”¹è¿›
1. å¢åŠ å¯¼å…¥è¿›åº¦ç›‘æ§å’Œæ—¥å¿—
2. æ”¯æŒå¢é‡æ›´æ–°å’Œå»é‡
3. è‡ªåŠ¨åŒ–å…ƒæ•°æ®éªŒè¯
4. æ”¯æŒæ›´å¤šOfficeæ–‡æ¡£æ ¼å¼

---

## ğŸ“ ç›¸å…³è”ç³»äºº

- **æŠ€æœ¯å®ç°**: Claude Code (Sequential Thinking Analysis)
- **æ–‡æ¡£æ¥æº**: åº”æ€¥ç®¡ç†éƒ¨æ¡ˆä¾‹åº“å’Œé¢„æ¡ˆåº“
- **ç³»ç»Ÿé›†æˆ**: emergency-agents-langgraph RAG Pipeline

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-28 15:35
**å¯¼å…¥å®Œæˆæ—¶é—´**: 2025-10-28 15:32
**æ€»è€—æ—¶**: çº¦45åˆ†é’Ÿ (åŒ…å«åˆ†æã€æå–ã€å¯¼å…¥ã€éªŒè¯)

âœ… **ä»»åŠ¡çŠ¶æ€**: åœ†æ»¡å®Œæˆ
