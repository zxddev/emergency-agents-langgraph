# 应急救灾路径与调度智能体开发规划

目标：在真实灾情下，按地/空/水多通道、二段投送、车队/排连协同，提供可审计的最优+备选路径与调度方案。以下按智能体拆分开发路线与里程碑（V1/V2/V3）。

## 共性基线（所有智能体需完成）
- 数据规范：障碍/封控/禁飞/水深/灾害热度的统一 schema（几何、时间窗、硬/软、来源、置信度）。
- 能力规范：平台能力（几何/动力/环境/编组/装备/技能）的统一字段；缺项报错，禁止兜底。
- 审计规范：硬约束命中/软豁免/无解的记录与原因透出；无直线兜底。
- 接口：HTTP/gRPC 或 LangGraph node 接口约定（输入/输出/错误码），统一坐标系与时间窗格式。

## 智能体 1：感知与障碍标注
- 职责：融合卫星/无人机/现场报/指挥中心，生成时空障碍层；区分硬阻断 vs 软惩罚；禁飞/限高网格，水域/积水深度，灾害热度栅格。
- V1：手工+已有数据源接入，输出统一障碍 JSON；提供查询接口 `list_obstacles(time_window, bbox)`。
- V2：自动融合多源，打标签（硬/软/来源/置信度）；增量更新；缓存策略。
- V3：质量控制与人工校核流；数据不确定性标记风险等级。

## 智能体 2：能力建模
- 职责：维护平台能力库（车/越野/履带/艇/狗/无人机）；提供能力查询；校验缺项报错。
- V1：完成能力表 schema 与存取；支持宽度、轴重、转弯、坡度/侧倾、涉水、续航/航时、抗风、载荷/装备/技能。
- V2：导入 DB/知识图谱/历史案例；版本化能力配置；支持编组策略（纵队长度、间距策略）。
- V3：能力动态退化/健康状况更新（传感器/人工上报）。

## 智能体 3：路径规划（地/空/水，K-best，二段投送）
- 职责：计算可行路径，返回最优+备选，附风险/约束命中/豁免审计。支持二段/多段投送（waypoint 链），车队约束。
- V1：重写代价函数  
  - 地面：距离×道路类型×坡度/侧倾×地表/积水×灾害热度×封控惩罚；硬障碍=∞。  
  - 空域：距离×风场/能见度×LoS×禁飞/限高惩罚；硬禁飞=∞；豁免=高惩罚+审计。  
  - 水域：航道/水深/流速；硬浅水/禁航=∞。  
  - K-best=2；二段投送通过 waypoint 分段；不可行边直接过滤。  
- V2：车队/排连校验（路宽≥车宽+安全边、桥限重、会车、同步到达）；K-best>2，禁用部分边求次优；续航/航时约束。
- V3：动态重规划（环境突变触发）；性能优化（缓存/分辨率自适应）；路径解释增强（geojson/tiles）。

## 智能体 4：调度与分配（OR-Tools）
- 职责：任务-平台匹配与顺序，满足时间窗/容量/技能/装备/优先级，支持二段投送前置关系。
- V1：VRP with time windows + capacity；成本矩阵由路径智能体计算并过滤不可行边；输出分配与序列。
- V2：多技能/多装备需求、优先级权重、二段投送前置（车到前沿→艇/狗起点衔接）；近似 K-best（禁边再求）。
- V3：大规模任务性能调优（分区/分阶段/启发式）；成本矩阵增量刷新；调度-路径闭环（环境变化触发重算）。

## 智能体 5：评估与解释
- 职责：汇总最优/备选的风险与约束命中，展示豁免审批链，提供可视化与审计日志。
- V1：输出风险列表（封控/禁飞/积水/桥限重命中）、豁免原因；生成审计条目。
- V2：可视化 geojson/tiles；对无解/高风险提供“最接近可行约束提示”。
- V3：执行监控 + 自动触发重规划；报表与复盘。

## 里程碑建议
- 里程碑 1（V1 骨架，1-2 周）：  
  - 完成共性基线 schema；能力表与障碍查询接口；路径代价函数重构 + K-best=2 + waypoint 分段；OR-Tools 基础调度；评估审计 V1。  
  - 交付：可调用的 API/节点，能在小范围场景出最优+备选，并输出审计。
- 里程碑 2（V2 升级，2-4 周）：  
  - 车队/排连校验；二段投送前置；多技能/装备调度；豁免审计完善；可视化。  
  - 交付：支持车队/二段投送场景的可执行方案与解释。
- 里程碑 3（V3 闭环与性能，>4 周）：  
  - 动态重规划、成本矩阵增量刷新、性能优化、执行监控触发；数据质量控制与人工校核流。  
  - 交付：可在动态灾情下持续更新的闭环系统。
