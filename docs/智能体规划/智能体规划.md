# 真实救灾路径与调度智能体总体目标

- 为地面车辆/越野车、无人机、无人艇、机器狗提供可落地的路径规划与调度，覆盖动态灾害/封控/禁飞/水深等约束，输出最优 + 备选方案及风险解释。
- 支持二段/多段投送链路（车→艇/狗/人），车队/排连协同（宽度、桥限重、间距、同步到达）。
- 调度与路径解耦：调度用 OR-Tools 负责“谁去哪里、顺序与时间窗”，路径智能体负责“怎么走”；通过可行性过滤 + 代价矩阵耦合。
- 全流程可审计：硬约束命中直接报错，软约束需有豁免开关与审计记录。

## 智能体角色与职责

1) 感知与障碍标注智能体  
   - 输入：卫星/无人机影像、现场人员汇报、指挥大厅同步、传感器。  
   - 输出：时空障碍层（线段/多边形/栅格），区分硬阻断/软惩罚；封控时间窗；禁飞/限高网格；水域/积水深度；灾害热度栅格。  
   - 接口：`list_obstacles(time_window, area) -> {segments, polygons, grid, metadata}`。  

2) 能力建模智能体  
   - 维护平台能力库：宽度、轴重/桥限重适配、最小转弯半径、最大坡度/侧倾、涉水深度、续航/航时、抗风、载荷/装备、编组规模/间距策略、速度。  
   - 数据源：DB + 知识图谱 + 历史案例；缺项报错，禁止兜底 light_vehicle。  
   - 接口：`get_capability(platform_id|type) -> capability_profile`。  

3) 路径规划智能体（地面/空域/水域分通道，支持 K-best 与二段投送）  
   - 地面代价：距离 × 道路类型 × 坡度/侧倾 × 地表/积水 × 灾害热度 × 封控惩罚；硬障碍=∞。  
   - 空域代价：距离 × 风场/能见度 × 链路 LoS × 禁飞/限高惩罚；硬禁飞=∞；应急豁免=惩罚+审计。  
   - 水域：航道/水深/流速，硬浅水/禁航=∞。  
   - 车队/排连：路宽≥车宽+安全边、桥限重、队列间距/时间窗、会车冲突；不满足直接无解。  
   - 二段/多段：支持 waypoint 链式规划（车→艇/狗/人），续航/航时校验。  
   - 输出：`K` 条候选路径，附风险/封控/禁飞命中与豁免原因。  

4) 调度与分配智能体（基于 OR-Tools）  
   - 目标：给任务分配平台与访问顺序，满足时间窗、容量/载荷、技能/装备匹配、优先级。  
   - 输入：任务点需求（物资/装备/技能）、时间窗、优先级；平台能力与可行边成本矩阵（由路径智能体计算）。  
   - 约束扩展：二段投送前置关系（车到前沿后，狗/艇二次出发），多技能/多装备需求，优先级/时效权重。  
   - 输出：任务—平台匹配、顺序、ETA，调用路径智能体生成实际路线。  

5) 评估与解释智能体  
   - 汇总最优/备选方案的风险与约束命中（封控/禁飞/积水/桥限重），显示豁免审批链。  
   - 产出可视化（geojson/tiles）和审计日志。  

## 实现路线（迭代版本）

### V1：最小可行
- 能力建模：补全车辆/艇/狗/无人机的能力表，缺项报错。  
- 障碍输入：新增时空障碍/禁飞/封控/水深数据结构与查询接口。  
- 路径规划：重写代价函数（地/空/水），硬阻断/软惩罚/豁免开关；支持 K-best=2；二段投送通过 waypoint 分段。  
- 调度：OR-Tools 基本 VRP/时间窗/容量 + 先验可行边过滤（不可行边不入模型）。  

### V2：协同与编组
- 车队/排连：路宽/限重/间距/会车/同步到达校验；无解显式报错。  
- 空域：风场/能见度/链路 LoS 引入代价，禁飞/限高豁免审计。  
- 二段投送：联动约束（车到前沿时间 ≥ 狗/艇起飞时间；起点=车终点；续航校验）。  
- 备选方案：K-best>2，支持“禁用上一条部分边”再求次优。  

### V3：智能体协作与解释
- LangGraph React 流程：感知 → 能力 → 调度 → 路径 → 解释；每步可替换/扩展。  
- 历史案例/知识图谱：影响调度权重与平台选择（技能/装备匹配）。  
- 审计：记录每次豁免、命中的硬约束、被过滤的不可行边。  

## 接口与存储草案
- 障碍/封控/禁飞存储：`obstacles` 表（类型、几何、时间窗、硬/软、置信度、来源）。  
- 能力：`platform_capabilities` 表（几何/动力/环境/编组参数、装备/技能）。  
- 路径规划接口：`plan_paths(request) -> {paths: [ {points, cost, risks, violated_soft, metrics} ] }`。  
- 调度接口：`assign_tasks(tasks, platforms, cost_matrix) -> assignment + sequences + eta`。  

## 验收要点
- 硬障碍/禁飞/封控命中即失败，无直线兜底。  
- 车队/二段投送约束触发时明确报错信息。  
- 输出至少一条最优 + 一条备选，并说明风险/惩罚来源。  
- 豁免需有开关与审计记录。  
